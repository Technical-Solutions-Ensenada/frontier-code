---
import Container from '../ui/Container.astro';
import Section from '../ui/Section.astro';
import StatCard from '../ui/StatCard.astro';
---

<Section id="about" class="!p-0 !bg-transparent">
  <div class="relative bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 overflow-hidden py-16 lg:py-20">

    <!-- Floating orbs -->
    <div class="absolute top-20 right-10 w-72 h-72 bg-blue-500 rounded-full blur-3xl opacity-20"></div>
    <div class="absolute bottom-20 left-10 w-96 h-96 bg-purple-500 rounded-full blur-3xl opacity-20"></div>

    <Container>
      <div class="relative max-w-6xl mx-auto">

        <!-- Header -->
        <div class="text-center mb-12">
          <h2 class="text-4xl sm:text-5xl font-light text-white leading-tight">
            Más que código,<br />
            <span class="bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 text-transparent bg-clip-text font-normal">
              construimos soluciones
            </span>
          </h2>
        </div>

        <!-- Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">

          <!-- Left column -->
          <div class="order-2 lg:order-1">
            <div class="relative w-14 h-14 -mt-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                  <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  <div class="absolute -top-1 -right-1 w-3 h-3 bg-blue-400 rounded-full animate-pulse"></div>
                  <div class="absolute -bottom-1 -left-1 w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.5s;"></div>
                </div>

            <div class="space-y-5 text-lg text-blue-100">
              <p>
                Fundada con la visión de
                <strong class="text-white">transformar negocios a través del software</strong>,
                Frontier Code desarrolla soluciones tecnológicas de alto impacto.
              </p>
              <p>
                Combinamos excelencia técnica con estrategia empresarial para generar
                <span class="text-blue-400 font-semibold">valor real</span>.
              </p>
            </div>
          </div>

          <!-- Right column: stats carousel -->
        <div class="order-1 lg:order-2 relative lg:sticky lg:top-24 h-[300px] overflow-hidden">
            <div
              id="stats-track"
              class="absolute inset-0 flex flex-col transition-transform duration-700 ease-out"
            >

            <div class="stat-slide h-[220px] flex items-center justify-center">
                <StatCard
                  number="50+"
                  title="Proyectos"
                  subtitle="Completados con éxito"
                />
              </div>

              <div class="stat-slide h-[220px] flex items-center justify-center">
                <StatCard
                  number="5+"
                  title="Años Exp."
                  subtitle="Experiencia combinada"
                />
              </div>

              <div class="stat-slide h-[220px] flex items-center justify-center">
                <StatCard
                  number="30+"
                  title="Clientes"
                  subtitle="Satisfechos"
                />
              </div>

              <div class="stat-slide h-[220px] flex items-center justify-center">
                <StatCard
                  number="15+"
                  title="Expertos"
                  subtitle="En el equipo"
                />
              </div>

            </div>
          </div>
        </div>
      </div>
    </Container>
  </div>
</Section>

<style>
  .stat-slide {
    flex-shrink: 0;
  }
</style>

<script is:inline>
  let currentIndex = 0
  let isLocked = false

  function initStatsCarousel() {
    if (window.innerWidth < 1024) return

    const section = document.getElementById('about')
    const track = document.getElementById('stats-track')
    const slides = document.querySelectorAll('.stat-slide')

    if (!section || !track || slides.length === 0) return

    const maxIndex = slides.length - 1

    function update() {
      track.style.transform = `translateY(-${currentIndex * 100}%)`
    }

      let sectionActive = false

const observer = new IntersectionObserver(
  ([entry]) => {
    sectionActive = entry.isIntersecting
  },
  {
    threshold: 0.6, // section is clearly in view
  }
)

observer.observe(section)


function onWheel(e) {
  if (!sectionActive) return

  const atFirst = currentIndex === 0
  const atLast = currentIndex === maxIndex

  // Allow normal scroll ONLY when carousel is finished
  if ((e.deltaY < 0 && atFirst) || (e.deltaY > 0 && atLast)) {
    return
  }

  e.preventDefault()

  if (isLocked) return
  isLocked = true

  if (e.deltaY > 0 && currentIndex < maxIndex) currentIndex++
  if (e.deltaY < 0 && currentIndex > 0) currentIndex--

  update()

  setTimeout(() => {
    isLocked = false
  }, 650)
}

    window.addEventListener('wheel', onWheel, { passive: false })
  }

  document.addEventListener('DOMContentLoaded', initStatsCarousel)
</script>


